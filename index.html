<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>

    <title>Momentum</title>
</head>
<body>
    <nav class="flex justify-end gap-5 ">
        <div class="bg-indigo-300 p-2 m-1 rounded-lg hover:bg-indigo-500" >Iniciar sesion</div>
        <div class="bg-indigo-300 p-2 m-1 rounded-lg hover:bg-indigo-500" id="registrarse"> Registrarse</div>
    </nav>
    <main>
        <div>
            <button id="newTask" class="bg-indigo-300 p-2 m-1 rounded-lg hover:bg-indigo-500">Nueva tarea</button>
            <button id="cancelar">cancelar</button>
            <div id="espacio"></div>
        </div>
       

        <div class=" flex flex-col-3 justify-between p-4" >
            <div class="bg-rose-300  p-4 w-96 " >Pendientes
                <div id="espacioPendiente"> </div>
            </div>
            <div class="bg-sky-300 p-4 w-96 " >En proceso
                <div id="espacioProceso"> </div>
            </div>
            <div class="bg-green-300 p-4 w-96 " >Completadas
                <div id="espacioCompletado"></div>
            </div>
        </div>
       
    </main>
    
</body>
<script>
    document.addEventListener("DOMContentLoaded", () =>{
        document.getElementById("newTask").addEventListener("click", ()=>{
            const espacio = document.getElementById("espacio");
            const espacioPendiente = document.getElementById("espacioPendiente")
            const espacioProceso = document.getElementById("espacioProceso")
            const espacioCompletado = document.getElementById("espacioCompletado")

            //crear form de tarea
            const formTarea = document.createElement("div")
            formTarea.classList.add("m-10", "bg-sky-100", "py-2", "rounded-lg")
            formTarea.innerHTML = `
            <form action="http://localhost:3000/tareas/" method="POST" onsubmit="crearTarea(this)" id="formTareaNueva">
                <label for="title">Titulo de la tarea</label>
                <input type="text" name="title" id="title" class="bg-white rounded-lg m-1 p-1" required>
                <br>
                <label for="descrition">Descripcion</label>
                <input type="text" name="descrition" id="descrition" class="bg-white rounded-lg m-1 p-1 required">
                <br>
                <label for="imagen">Url de la imagen</label>
                <input type="text" name="imagen" id="imagen" class="bg-white rounded-lg m-1 p-1">
                <br>
                <label for="fInici">Fecha incio de la tarea</label>
                <input type="date" name="fInici" id="fInici" class="bg-white rounded-lg m-1 p-1" required>
                <br>
                <label for="fFin">Fecha finalizacion de la tarea</label>
                <input type="date" name="fFin" id="fFin" class="bg-white rounded-lg m-1 p-1" required>
                <br>
                <select name="tipoTarea" id="tipoTarea" required>
                    <option value="pendiente">Pendiente</option>
                    <option value="proceso"> En proceso</option>
                    <option value="terminada">terminada</option>
                </select>
                <br>
                <div class="flex justify-center">
                    <button class="bg-green-300 p-2 m-1 rounded-lg" id="formu" type="submit">subir tarea</button>
                </div>
               
            </form>
            
            `;
            espacio.appendChild(formTarea)
        })
        

        function mostrarTareas(tareas){         
                espacioPendiente.innerHTML = '';
                tareas.forEach((tarea) => {
                const listado = document.createElement("div")   
                listado.classList.add("flex", "justify-between", "items-center", "bg-white", "p-3", "rounded", "shadow", "m-3"  )  
                let tareaTexto = document.createElement("div");
                
                listado.innerHTML= `<div> 
                    <div class="flex justify-center">
                        <h1>${tarea.title} </h1> </div>
                    
                    <p>${tarea.descrition} </p>
                    <div> <img src="${tarea.imagen}" alt="tarea"  class="w-30 h-40"> </div>
                    <div class=" flex flex-col-2 gap-6 m-2"> 
                        <div>inicio: ${tarea.fInici} </div>
                        <div>fin: ${tarea.fFin} </div> </div>


                    <div>
                        <button class="bg-rose-400 rounded-lg p-1 m-1" id="borrarTarea">Borrar </button></div>

                    </div>`;

                listado.querySelector('div').appendChild(tareaTexto);
                

                if(tarea.tipoTarea === "pendiente"){
                    espacioPendiente.appendChild(listado)
               } else if(tarea.tipoTarea === "proceso"){
                    espacioProceso.appendChild(listado)
               }else if(tarea.tipoTarea === "terminada"){
                 espacioCompletado.appendChild(listado)
               }else{
                console.log("no existe estado")
               }
            


            })
        
           
            

        }
       
        const borrarTarea = document.getElementById("borrarTarea")
        window.borrarTarea = function(id) {
            fetch(`http://localhost:3000/tareas/${id}`, {
                method: "DELETE",
            })
            .then((response) => response.json())
            .then((data) => {
                cargarTareas();
            })
            .catch((error) => console.error("Error al eliminar la tarea:", error));
        

        }


        function cargarTarea (){
            fetch("http://localhost:3000/tareas")
            .then((responde) => responde.json())
            .then((tareas) => mostrarTareas(tareas))
            .catch((error) => console.error("error al cargar las tareas"+ error))
        }

        cargarTarea()
    })

</script>
</html>